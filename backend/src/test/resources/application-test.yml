logging:
  level:
    org.springframework.security: DEBUG
    com.example: DEBUG
app:
  security:
    rules:
      # Swagger-UI / API Docs（すべて公開）
      - { pattern: /swagger-ui.html, access: PERMIT_ALL }
      - { pattern: /swagger-ui/**,   access: PERMIT_ALL }
      - { pattern: /v3/api-docs/**,  access: PERMIT_ALL }

      # ---------------------------
      # 公開API（匿名許可の“例外”）—個別列挙
      # ---------------------------

      # Hello（例）
      - { pattern: /api/hello/public, methods: [GET], access: PERMIT_ALL }

      # UserController（匿名OK）
      - { pattern: /api/users/register, methods: [POST], access: PERMIT_ALL }
      - { pattern: /api/users/login,    methods: [POST], access: PERMIT_ALL }

      # VideoController（公開系）
      - { pattern: /api/videos/search,              methods: [GET],   access: PERMIT_ALL }   # ← ルート検索のみ
      - { pattern: "/api/videos/{id}",              methods: [GET],   access: PERMIT_ALL }
      - { pattern: "/api/videos/user/{userId}",     methods: [GET],   access: PERMIT_ALL }
      - { pattern: /api/videos/popular,             methods: [GET],   access: PERMIT_ALL }
      - { pattern: /api/videos/recent,              methods: [GET],   access: PERMIT_ALL }
      - { pattern: "/api/videos/{id}/views",        methods: [PATCH], access: PERMIT_ALL }

      # LiveStreamController（公開系）
      - { pattern: "/api/live-streams/{id}",                   methods: [GET], access: PERMIT_ALL }
      - { pattern: "/api/live-streams/user/{userId}",         methods: [GET], access: PERMIT_ALL }
      - { pattern: "/api/live-streams/user/{userId}/status",  methods: [GET], access: PERMIT_ALL }
      - { pattern: /api/live-streams/status,                  methods: [GET], access: PERMIT_ALL }
      - { pattern: /api/live-streams/statuses,                methods: [GET], access: PERMIT_ALL }
      - { pattern: /api/live-streams/search,                  methods: [GET], access: PERMIT_ALL }
      - { pattern: "/api/live-streams/key/{streamKey}",       methods: [GET], access: PERMIT_ALL }

      # CategoryController（一覧・検索・取得は公開）
      - { pattern: /api/categories,           methods: [GET], access: PERMIT_ALL }
      - { pattern: "/api/categories/{id}",    methods: [GET], access: PERMIT_ALL }

      # ---------------------------
      # 認証必須（既定）
      # ---------------------------
      - { pattern: /api/hello/private, methods: [GET], access: AUTHENTICATED }

      # Video × Category 関連操作
      - { pattern: "/api/videos/{videoId}/categories",          methods: [POST, PUT], access: AUTHENTICATED }
      - { pattern: "/api/videos/{videoId}/categories/{categoryId}", methods: [DELETE], access: AUTHENTICATED }

      # LiveStream × Category 関連操作
      - { pattern: "/api/livestreams/{liveStreamId}/categories",          methods: [POST, PUT], access: AUTHENTICATED }
      - { pattern: "/api/livestreams/{liveStreamId}/categories/{categoryId}", methods: [DELETE], access: AUTHENTICATED }

      # 例：管理者専用
      - { pattern: /api/admin/ping, methods: [GET], access: HAS_ROLE, roles: [ADMIN] }
      - { pattern: "/api/users/{id}/restore", methods: [PUT], access: HAS_ROLE, roles: [ADMIN] }
      - { pattern: "/api/videos/{id}/restore", methods: [PUT], access: HAS_ROLE, roles: [ADMIN] }
      - { pattern: /api/categories,           methods: [POST], access: HAS_ROLE, roles: [ADMIN] }
      - { pattern: "/api/categories/{id}",    methods: [PUT, DELETE], access: HAS_ROLE, roles: [ADMIN] }

      # 既定ルール（クラス直付け bearerAuth を前提）
      - { pattern: /api/users/**,         access: AUTHENTICATED }
      - { pattern: /api/videos/**,        access: AUTHENTICATED }
      - { pattern: /api/live-streams/**,  access: AUTHENTICATED }

spring:
  output:
    ansi:
      enabled: ALWAYS
